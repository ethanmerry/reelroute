<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle"> ReelRoute</title>
    <script src="movietitle.js"></script>
    <script>
        sessionStorage.setItem('links', 0);
        var nowdate = new Date()
        sessionStorage.setItem('startTime', nowdate);
        const fs = require('fs');

        fs.readFile('startingMovie.json', 'utf8', (err, jsonString) => {
        if (err) {
            console.log('Error reading file:', err);
            return;
        }

        const data = JSON.parse(jsonString);

        // Access the data from the JSON file
        const id = data.id;
        });
        sessionStorage.setItem('id', 13);
        sessionStorage.setItem('type', "movie");
    </script>
    <link rel="icon" type="image/x-icon" href="images/favicon.svg">
    <link rel="stylesheet" href="play.css">
</head>
<body>
    <div class="main">
        <img draggable="false" class="moviebg" src="moviebg.jpg">
        <div class="gradmoviebg"></div>
        <a href="howtoplay.html" target=”_blank” attribute> <img draggable="false" class="howto" src="images/icons/How to Play.svg"> </a>
        <img draggable="false" class="movielogo" src="movielogo.png">
        <div id="container" class="cast">
            <script>
                // Function to fetch movie details by movie ID
                async function fetchMovieDetails(movieId) {
                const apiKey = '3359eee818730a0f011a07b7e6e73375'; // Replace with your TMDB API key
                const url = `https://api.themoviedb.org/3/movie/${movieId}/credits?api_key=${apiKey}`;

                try {
                    const response = await fetch(url);
                    const data = await response.json();
                    return data.cast;
                } catch (error) {
                    console.log('Error fetching movie details:', error);
                    return [];
                }
                }

                // Function to fetch actor/crew details by person ID
                async function fetchPersonDetails(personId, creditType) {
                    const apiKey = '3359eee818730a0f011a07b7e6e73375'; // Replace with your TMDB API key
                    const url = `https://api.themoviedb.org/3/person/${personId}/${creditType}?api_key=${apiKey}`;

                try {
                    const response = await fetch(url);
                    const data = await response.json();
                    return data.cast;
                } catch (error) {
                    console.log('Error fetching person details:', error);
                    return [];
                }
                }

                // Check session storage for the "type" and "id" values
                const type = sessionStorage.getItem('type');
                const id = sessionStorage.getItem('id');

                // Function to create and append an image and text element to a parent element
                function createImageWithText(parentElement, imageUrl, text) {
                    const wrapperElement = document.createElement('div');
                    wrapperElement.className = 'item';
                    item.draggable = false;

                    const imageElement = document.createElement('img');
                    imageElement.src = imageUrl;
                    imageElement.className = 'image';
                    wrapperElement.appendChild(imageElement);

                    const textElement = document.createElement('p');
                    textElement.textContent = text;
                    textElement.className = 'caption';
                    wrapperElement.appendChild(textElement);

                    parentElement.appendChild(wrapperElement);
                    }

                // Function to handle the different types and fetch the required data
                async function fetchDataByType(type, id) {
                    if (type === 'movie') {
                        const movieCredits = await fetchMovieDetails(id);
                        const containerElement = document.getElementById('container');
                        movieCredits.forEach((cast) => {
                        if (cast.profile_path) {
                            const image = `https://image.tmdb.org/t/p/w200${cast.profile_path}`;
                            const name = cast.name;
                            createImageWithText(containerElement, image, name);
                        }
                        });
                    } else if (type === 'cast') {
                        const creditType = type === 'director' ? 'movie_credits' : 'combined_credits';
                        const personCredits = await fetchPersonDetails(id, creditType);
                        const containerElement = document.getElementById('container');
                        personCredits.forEach((credit) => {
                        if (credit.media_type === 'movie' && credit.poster_path) {
                            const image = `https://image.tmdb.org/t/p/w200${credit.poster_path}`;
                            const name = credit.title;
                            createImageWithText(containerElement, image, name);
                        }
                        });
                    } else {
                        console.log('Invalid type');
                    }
                    }

                // Call the function to fetch and handle the data based on the type and id
                fetchDataByType(type, id);
            </script>
        </div>
    </div>
    <div class="sidebar">
        <img draggable="false" class="logo" src="images/ReelRoute White.svg">
        <img draggable="false" id="poster" src="" alt="film poster">
        <!--<script src="script.js"></script>-->
        <div class="linktime">
            <div class="boxbg">
                <h2 class="subtitle">TO</h2>
                <img draggable="false" id="tologo" class="tologo" src="">
                <h2 class="subtitle">2015</h2>
            </div>
            <div class="boxbg">
                <h2 class="subtitle">LINKS</h2>
                <h3 id="linksnum" class="info">0</h3>
                <script>
                    var links = sessionStorage.getItem('links');
                    document.getElementById('linksnum').textContent = links;
                </script>
            </div>
            <div class="boxbg">
                <h2 class="subtitle">TIME</h2>
                <h3 id="time" class="info">00:00</h3>
                <script>
                    // Get the element to display the timer
                    const timerElement = document.getElementById('time');

                    // Set the start time
                    let startTime = new Date().getTime();

                    // Update the timer every second
                    setInterval(updateTimer, 1000);

                    function updateTimer() {
                        // Get the current time
                        let currentTime = new Date().getTime();

                        // Calculate the elapsed time in milliseconds
                        let elapsedTime = currentTime - startTime;

                        // Calculate minutes and seconds
                        let minutes = Math.floor(elapsedTime / 60000);
                        let seconds = Math.floor((elapsedTime % 60000) / 1000);

                        // Format the minutes and seconds as "00" if they are single-digit
                        let formattedMinutes = minutes < 10 ? '0' + minutes : minutes;
                        let formattedSeconds = seconds < 10 ? '0' + seconds : seconds;

                        // Update the timer element with the formatted time
                        timerElement.textContent = formattedMinutes + ':' + formattedSeconds;
                    }
                </script>            
            </div>
        </div>
   </div>
    
</body>
</html>
